<template>
    <div class="card" :style="cardStyle" @mousedown.stop="startDrag" @mouseover="hover = true" @mouseleave="hover = false">
      <img :src="imageSrc" alt="Card Image">
      <!-- Hover Buttons -->
      <div v-if="hover" class="hover-buttons">
        <button class="button-left">‚ü≤</button>
        <button class="button-center" @click.stop="showCardDetail">üëÅÔ∏è</button>
        <button class="button-right">‚ü≥</button>
      </div>
    </div>
    <CardModal :imageSrc="imageSrc" ref="cardModal"></CardModal>
  </template>
  
  <script>
  import CardModal from './CardModal.vue';
  export default {
    emits: ['update-position', 'show-card'],
    components: {
      CardModal
    },
    props: {
      imageSrc: String,
      initialPosition: {
        type: Object,
        default: () => ({ x: 100, y: 100 })
      },
      scale: Number,
      offsetX: Number,
      offsetY: Number,
      pIndex: Number,
      reverseMovement: {
        type: Boolean,
        default: false
      },
      player: String
    },
    data() {
      return {
        position: this.initialPosition,
        isDragging: false,
        cardOffsetX: 0,
        cardOffsetY: 0,
        correctedX: null,
        correctedY: null,
        startDragPosition: null,
        hover: false
      };
    },
    mounted() {
      document.addEventListener('mousemove', this.drag);
      document.addEventListener('mouseup', this.endDrag);
    },
    computed: {
      cardStyle() {
        let style = {
          left: this.position.x + 'px',
          top: this.position.y + 'px',
          position: 'fixed',
          cursor: 'pointer'
        };

        switch (this.pIndex) {
          case 1:
          case 2:
            style.transform = 'rotate(180deg)';
        }

        return style;
      }
    },
    methods: {
      startDrag(event) {
        event.preventDefault();
        this.isDragging = true;
        this.startDragPosition = { x: this.position.x, y: this.position.y };
        console.log(this.startDragPosition);
        const correctedX = (event.clientX - this.offsetX) / this.scale;
        const correctedY = (event.clientY - this.offsetY) / this.scale;
        this.cardOffsetX = correctedX - this.position.x;
        this.cardOffsetY = correctedY - this.position.y;
      },
      drag(event) {
        if (!this.isDragging) return;
        const mouseX = (event.clientX - this.offsetX) / this.scale;
        const mouseY = (event.clientY - this.offsetY) / this.scale;

        // Calculate the new position
        let newPositionX = mouseX - this.cardOffsetX;
        let newPositionY = mouseY - this.cardOffsetY;

        if (this.reverseMovement) {
          // For reversed movement, invert the direction
          newPositionX = - newPositionX + 2 * this.startDragPosition.x;
          newPositionY = - newPositionY + 2 * this.startDragPosition.y;
        }

        // Update the card's position
        this.position.x = newPositionX;
        this.position.y = newPositionY;
      },
      endDrag() {
        this.isDragging = false;
        this.$emit('update-position', { x: this.position.x, y: this.position.y });
      },
      showCardDetail() {
        this.$emit('show-card', this.imageSrc);
      }
    }
  };
  </script>
  
  <style>
.card img {
  width: 100%;
  height: auto;
  display: block;
}

.card {
  position: relative; /* Needed to position child elements absolutely */
}

.hover-buttons {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  align-items: start;
}

.button-left, .button-center, .button-right {
  background: #FFF;
  border: none;
  cursor: pointer;
  padding: 5px;
  border-radius: 50%;
}

.button-left:hover, .button-center:hover, .button-right:hover{
  background: #a99d9d;
}

.button-center {
  margin: 0 auto;
}
</style>

  